<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>Predictions | ApeHub</title>
  <link rel="icon" href="https://qtrypzzcjebvfcihiynt.supabase.co/storage/v1/object/public/base44-prod/public/694f4eec318421fe521395b3/d35e25880_D4D1B7AE-C152-443F-8566-E9E376230D42.JPG" type="image/jpeg">
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg-deep: #000000;
      --bg-card: #0a0a0f;
      --bg-card-hover: #12121a;
      --bg-elevated: #16161f;
      --purple-core: #7c3aed;
      --purple-glow: #a855f7;
      --purple-soft: #c4b5fd;
      --purple-pink: #e879f9;
      --green: #10b981;
      --green-glow: #34d399;
      --red: #ef4444;
      --red-glow: #f87171;
      --gold: #fbbf24;
      --white: #ffffff;
      --white-90: rgba(255,255,255,0.9);
      --white-70: rgba(255,255,255,0.7);
      --white-50: rgba(255,255,255,0.5);
      --white-30: rgba(255,255,255,0.3);
      --white-10: rgba(255,255,255,0.1);
      --white-05: rgba(255,255,255,0.05);
      --teal: #06b6d4;
      --teal-dark: #0891b2;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    html, body { font-family: 'Space Grotesk', -apple-system, sans-serif; background: linear-gradient(180deg, #050a0f 0%, #0a1520 50%, #0d1a28 100%); color: var(--white); min-height: 100vh; overflow-x: hidden; }

    /* Header - WallStreetPredict Style */
    .header { position: fixed; top: 0; left: 0; right: 0; z-index: 100; padding: 14px 20px; background: linear-gradient(180deg, rgba(10, 21, 32, 0.95) 0%, rgba(5, 10, 15, 0.95) 100%); backdrop-filter: blur(20px); display: flex; justify-content: flex-end; align-items: center; }
    .logo { font-size: 17px; font-weight: 700; letter-spacing: -0.5px; color: var(--white); display: flex; align-items: center; gap: 6px; }
    .logo-icon { font-size: 18px; }
    .logo span { color: #06b6d4; }
    .token-balance { display: flex; align-items: baseline; gap: 6px; cursor: pointer; transition: all 0.2s; }
    .token-balance:hover { opacity: 0.8; }
    .token-icon { display: none; }
    .token-amount { font-family: 'Space Grotesk', -apple-system, sans-serif; font-weight: 600; font-size: 16px; color: var(--white); }
    .token-label { font-family: 'Space Grotesk', -apple-system, sans-serif; font-weight: 500; font-size: 12px; color: var(--white-50); }
    .add-tokens { display: none; }
    .header-actions { display: flex; align-items: center; gap: 10px; }
    .header-icon-btn { width: 38px; height: 38px; background: rgba(6, 182, 212, 0.1); border: 1px solid rgba(6, 182, 212, 0.2); border-radius: 10px; display: flex; align-items: center; justify-content: center; color: var(--white-70); font-size: 16px; cursor: pointer; transition: all 0.2s; }
    .header-icon-btn:hover { background: rgba(6, 182, 212, 0.2); border-color: #06b6d4; color: var(--white); }
    .my-bets-btn { display: none; }

    /* My Bets Modal */
    .my-bets-modal { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.9); backdrop-filter: blur(10px); z-index: 300; opacity: 0; visibility: hidden; transition: all 0.3s; overflow-y: auto; }
    .my-bets-modal.show { opacity: 1; visibility: visible; }
    .my-bets-content { max-width: 500px; margin: 0 auto; padding: 20px 16px 100px; }
    .my-bets-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding-top: 10px; }
    .my-bets-title { font-size: 24px; font-weight: 700; }
    .my-bets-close { width: 40px; height: 40px; background: var(--white-10); border: none; border-radius: 50%; color: var(--white); font-size: 24px; cursor: pointer; display: flex; align-items: center; justify-content: center; }
    .my-bets-tabs { display: flex; gap: 8px; margin-bottom: 20px; }
    .my-bets-tab { flex: 1; padding: 12px; background: var(--white-05); border: 2px solid var(--white-10); border-radius: 12px; font-family: inherit; font-size: 14px; font-weight: 600; color: var(--white-50); cursor: pointer; transition: all 0.2s; text-align: center; }
    .my-bets-tab.active { border-color: var(--purple-core); color: var(--purple-glow); background: rgba(124, 58, 237, 0.1); }
    .bet-history-card { background: #12121a; border: 1px solid var(--white-20); border-radius: 14px; padding: 16px; margin-bottom: 12px; }
    .bet-history-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 10px; }
    .bet-history-ticker { background: rgba(124, 58, 237, 0.2); padding: 4px 10px; border-radius: 6px; font-family: 'JetBrains Mono', monospace; font-size: 12px; font-weight: 600; color: var(--purple-soft); }
    .bet-history-status { padding: 4px 10px; border-radius: 6px; font-size: 11px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; }
    .bet-history-status.active { background: rgba(124, 58, 237, 0.2); color: var(--purple-glow); }
    .bet-history-status.won { background: rgba(16, 185, 129, 0.2); color: var(--green); }
    .bet-history-status.lost { background: rgba(239, 68, 68, 0.2); color: var(--red); }
    .bet-history-title { font-size: 15px; font-weight: 600; color: var(--white-90); margin-bottom: 12px; line-height: 1.4; }
    .bet-history-details { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
    .bet-detail { background: var(--white-05); padding: 10px 12px; border-radius: 8px; }
    .bet-detail-label { font-size: 11px; color: var(--white-50); margin-bottom: 2px; }
    .bet-detail-value { font-family: 'JetBrains Mono', monospace; font-size: 14px; font-weight: 600; }
    .bet-detail-value.yes { color: var(--green); }
    .bet-detail-value.no { color: var(--red); }
    .bet-history-footer { display: flex; justify-content: space-between; margin-top: 12px; padding-top: 12px; border-top: 1px solid var(--white-10); font-size: 12px; color: var(--white-50); }
    .no-bets { text-align: center; padding: 60px 20px; }
    .no-bets-icon { font-size: 48px; margin-bottom: 16px; }
    .no-bets-title { font-size: 18px; font-weight: 600; margin-bottom: 8px; }

    /* Main - WallStreetPredict Style */
    .main { padding: 80px 16px 120px; max-width: 600px; margin: 0 auto; background: transparent; min-height: 100vh; }

    /* Category Tabs - Matching Bet Slip Style */
    .category-tabs { display: flex; gap: 10px; padding: 16px 0; overflow-x: auto; -webkit-overflow-scrolling: touch; scrollbar-width: none; }
    .category-tabs::-webkit-scrollbar { display: none; }
    .category-tab { padding: 12px 18px; background: var(--white-05); border: 2px solid var(--white-10); border-radius: 14px; font-family: inherit; font-size: 14px; font-weight: 600; color: var(--white-50); cursor: pointer; white-space: nowrap; transition: all 0.2s; }
    .category-tab:hover { background: var(--white-10); border-color: var(--white-30); color: var(--white-70); }
    .category-tab.active { background: rgba(30, 64, 175, 0.15); border-color: #3b82f6; color: var(--white); }

    /* Prediction Cards - WallStreetPredict Style */
    .predictions-grid { display: flex; flex-direction: column; gap: 16px; }
    .prediction-card { background: linear-gradient(180deg, #0d1a28, #050a0f); border: 1px solid rgba(6, 182, 212, 0.2); border-radius: 24px; padding: 20px; cursor: pointer; transition: all 0.3s; position: relative; overflow: hidden; }
    .prediction-card::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 1px; background: linear-gradient(90deg, transparent, rgba(6, 182, 212, 0.3), transparent); }
    .prediction-card:hover { border-color: rgba(6, 182, 212, 0.4); transform: translateY(-2px); box-shadow: 0 8px 32px rgba(6, 182, 212, 0.15); }
    .prediction-card.featured { border-color: rgba(168, 85, 247, 0.4); }
    .prediction-card.featured::before { background: linear-gradient(90deg, transparent, rgba(168, 85, 247, 0.4), transparent); }
    
    /* Locked prediction state */
    .prediction-card.locked { border-color: rgba(255,255,255,0.1); opacity: 0.85; }
    .prediction-card.locked:hover { transform: none; border-color: rgba(255,255,255,0.15); box-shadow: none; }
    .locked-badge { position: absolute; top: 16px; right: 16px; background: rgba(75, 85, 99, 0.9); padding: 6px 14px; border-radius: 8px; font-size: 12px; font-weight: 700; letter-spacing: 0.5px; color: #fff; z-index: 10; }
    .locked-text { color: var(--white-70); }
    .odds-button.disabled { opacity: 0.5; cursor: not-allowed; }
    .odds-button.disabled:hover { background: rgba(255,255,255,0.05); border-color: transparent; transform: none; }
    
    /* Source Badge */
    .prediction-source { display: inline-flex; align-items: center; gap: 6px; background: rgba(239, 68, 68, 0.12); padding: 6px 12px; border-radius: 8px; margin-bottom: 14px; }
    .source-icon { width: 18px; height: 18px; background: linear-gradient(135deg, #ef4444, #dc2626); border-radius: 4px; display: flex; align-items: center; justify-content: center; font-size: 10px; font-weight: 700; color: #fff; }
    .source-name { font-size: 12px; font-weight: 600; color: var(--white-70); letter-spacing: 0.3px; }
    
    /* Card Content Layout */
    .prediction-content { display: flex; justify-content: space-between; align-items: flex-start; gap: 16px; margin-bottom: 16px; }
    .prediction-info { flex: 1; }
    
    /* Probability Display */
    .prediction-probability { display: flex; align-items: baseline; gap: 8px; margin-top: 10px; }
    .probability-label { font-size: 14px; color: var(--white-50); }
    .probability-value { font-family: 'JetBrains Mono', monospace; font-size: 20px; font-weight: 600; color: var(--white); }
    .probability-change { font-family: 'JetBrains Mono', monospace; font-size: 12px; font-weight: 600; }
    .probability-change.up { color: var(--green); }
    .probability-change.down { color: var(--red); }
    
    .prediction-meta { display: flex; align-items: center; gap: 8px; margin-bottom: 12px; flex-wrap: wrap; }
    .prediction-ticker-wrap { display: flex; flex-direction: row; align-items: center; gap: 12px; }
    .prediction-ticker { background: var(--white-05); padding: 6px 14px; border-radius: 10px; font-family: 'JetBrains Mono', monospace; font-size: 14px; font-weight: 600; color: var(--white-70); border: 2px solid var(--white-10); box-shadow: none; letter-spacing: 0.5px; }
    .prediction-price { font-size: 14px; font-family: 'JetBrains Mono', monospace; font-weight: 600; }
    .prediction-category { font-size: 12px; color: var(--white-70); text-transform: uppercase; letter-spacing: 0.5px; }
    .prediction-date { font-size: 13px; color: #06b6d4; margin-left: auto; }
    .bet-slip-date { font-size: 13px; color: #06b6d4; margin-top: 6px; }
    .prediction-title { font-size: 20px; font-weight: 600; line-height: 1.4; margin-bottom: 0; color: #fff; }
    .prediction-reference { font-size: 11px; color: var(--white-50); margin-bottom: 12px; font-family: 'JetBrains Mono', monospace; display: flex; gap: 12px; flex-wrap: wrap; }
    .prediction-reference .ref-item { background: var(--white-05); padding: 4px 8px; border-radius: 6px; }
    .prediction-reference .ref-label { color: var(--white-50); }
    .prediction-reference .ref-value { color: var(--gold); font-weight: 600; }
    .prediction-reference .ref-value.positive { color: var(--green); }
    .prediction-reference .ref-value.negative { color: var(--red); }
    
    /* Stacked Buy Buttons - Matching Bet Slip Style */
    .prediction-odds { display: flex; flex-direction: row; gap: 12px; margin-top: 16px; }
    .odds-button { flex: 1; padding: 16px 12px; border-radius: 14px; border: 2px solid var(--white-10); background: var(--white-05); font-family: inherit; cursor: pointer; transition: all 0.2s; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 4px; }
    .odds-button.yes { border-color: rgba(16, 185, 129, 0.3); background: rgba(16, 185, 129, 0.08); }
    .odds-button.yes:hover { border-color: var(--green); background: rgba(16, 185, 129, 0.15); }
    .odds-button.yes.selected { border-color: var(--green); background: rgba(16, 185, 129, 0.15); }
    .odds-button.no { border-color: rgba(239, 68, 68, 0.3); background: rgba(239, 68, 68, 0.08); }
    .odds-button.no:hover { border-color: var(--red); background: rgba(239, 68, 68, 0.15); }
    .odds-button.no.selected { border-color: var(--red); background: rgba(239, 68, 68, 0.15); }
    .odds-label { font-size: 16px; font-weight: 700; letter-spacing: 0.5px; }
    .odds-button.yes .odds-label { color: var(--green); }
    .odds-button.no .odds-label { color: var(--red); }
    .odds-price { font-family: 'JetBrains Mono', monospace; font-size: 13px; font-weight: 500; color: var(--white-50); }
    .odds-separator { display: none; }
    .odds-multiplier { font-family: 'JetBrains Mono', monospace; font-size: 14px; font-weight: 700; color: var(--white); }
    .odds-button.disabled { opacity: 0.5; cursor: not-allowed; }
    .odds-button.disabled:hover { transform: none; box-shadow: none; border-color: var(--white-10); background: var(--white-05); }
    
    .prediction-footer { display: flex; justify-content: space-between; align-items: center; margin-top: 16px; padding-top: 14px; border-top: 1px solid rgba(255,255,255,0.08); }
    .prediction-volume { font-size: 12px; color: var(--white-50); }
    .prediction-volume strong { color: var(--white-70); font-family: 'JetBrains Mono', monospace; }
    .prediction-closes { font-size: 12px; color: var(--white-50); }
    .prediction-closes .time { color: #06b6d4; font-weight: 600; }

    /* Bet Slip - Receipt Style */
    .bet-slip-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.7); backdrop-filter: blur(10px); z-index: 200; opacity: 0; visibility: hidden; transition: all 0.3s; }
    .bet-slip-overlay.show { opacity: 1; visibility: visible; }
    .bet-slip { position: fixed; left: 0; right: 0; bottom: 0; background: linear-gradient(180deg, #0d1a28, #050a0f); border-top-left-radius: 0; border-top-right-radius: 0; padding: 30px 20px 40px; padding-bottom: calc(40px + env(safe-area-inset-bottom)); z-index: 201; transform: translateY(100%); transition: transform 0.4s cubic-bezier(0.16, 1, 0.3, 1); max-height: 85vh; overflow-y: auto; -webkit-overflow-scrolling: touch; }
    .bet-slip::before { content: ''; position: absolute; top: -10px; left: 0; right: 0; height: 20px; background: linear-gradient(180deg, #0d1a28, #050a0f); mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 20'%3E%3Cpath d='M0,20 L0,10 Q5,0 10,10 T20,10 T30,10 T40,10 T50,10 T60,10 T70,10 T80,10 T90,10 T100,10 L100,20 Z' fill='black'/%3E%3C/svg%3E"); -webkit-mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 20'%3E%3Cpath d='M0,20 L0,10 Q5,0 10,10 T20,10 T30,10 T40,10 T50,10 T60,10 T70,10 T80,10 T90,10 T100,10 L100,20 Z' fill='black'/%3E%3C/svg%3E"); mask-size: 50px 20px; -webkit-mask-size: 50px 20px; mask-repeat: repeat-x; -webkit-mask-repeat: repeat-x; }
    .bet-slip-overlay.show .bet-slip { transform: translateY(0); }
    .bet-slip-handle { width: 40px; height: 4px; background: rgba(168, 125, 82, 0.5); border-radius: 2px; margin: 0 auto 20px; }
    .bet-slip-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 20px; }
    .bet-slip-title { font-size: 14px; color: var(--white-50); margin-bottom: 4px; }
    .bet-slip-question { font-size: 20px; font-weight: 600; max-width: 280px; }
    .bet-slip-close { width: 36px; height: 36px; background: var(--white-10); border: none; border-radius: 50%; color: var(--white-70); font-size: 20px; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.2s; }
    .bet-slip-close:hover { background: var(--white-20); color: var(--white); }

    /* Position Selector */
    .position-selector { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 24px; }
    .position-btn { padding: 20px; border-radius: 16px; border: 2px solid var(--white-10); background: var(--white-05); cursor: pointer; transition: all 0.2s; text-align: center; }
    .position-btn.yes.selected { border-color: var(--green); background: rgba(16, 185, 129, 0.15); }
    .position-btn.no.selected { border-color: var(--red); background: rgba(239, 68, 68, 0.15); }
    .position-btn-label { font-size: 18px; font-weight: 700; margin-bottom: 4px; }
    .position-btn.yes .position-btn-label { color: var(--green); }
    .position-btn.no .position-btn-label { color: var(--red); }
    .position-btn-multiplier { font-family: 'JetBrains Mono', monospace; font-size: 14px; color: var(--white-50); }

    /* Token Quick Select */
    .token-quick-select { display: flex; gap: 10px; margin-bottom: 16px; }
    .token-quick-btn { flex: 1; padding: 14px 8px; background: var(--white-05); border: 2px solid var(--white-10); border-radius: 12px; font-family: 'JetBrains Mono', monospace; font-size: 16px; font-weight: 600; color: var(--white-70); cursor: pointer; transition: all 0.2s; }
    .token-quick-btn:hover { background: var(--white-10); border-color: var(--white-30); color: var(--white); }
    .token-quick-btn.selected { background: linear-gradient(135deg, var(--purple-core), var(--purple-glow)); border-color: var(--purple-glow); color: var(--white); }

    /* Custom Amount */
    .custom-amount-row { display: flex; align-items: center; gap: 12px; margin-bottom: 20px; }
    .custom-amount-input { flex: 1; padding: 16px; background: var(--white-05); border: 2px solid var(--white-10); border-radius: 12px; font-family: 'JetBrains Mono', monospace; font-size: 18px; font-weight: 600; color: var(--white); outline: none; transition: all 0.2s; }
    .custom-amount-input:focus { border-color: var(--purple-glow); background: rgba(124, 58, 237, 0.1); }
    .custom-amount-input::placeholder { color: var(--white-30); }
    .max-btn { padding: 16px 20px; background: var(--white-10); border: none; border-radius: 12px; font-family: inherit; font-size: 14px; font-weight: 600; color: var(--purple-glow); cursor: pointer; transition: all 0.2s; }
    .max-btn:hover { background: rgba(124, 58, 237, 0.2); }

    /* Payout Preview */
    .payout-preview { background: var(--white-05); border-radius: 16px; padding: 20px; margin-bottom: 20px; }
    .payout-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
    .payout-row:last-child { margin-bottom: 0; padding-top: 12px; border-top: 1px solid var(--white-10); }
    .payout-label { font-size: 14px; color: var(--white-50); }
    .payout-value { font-family: 'JetBrains Mono', monospace; font-size: 16px; font-weight: 600; color: var(--white); }
    .payout-value.profit { color: var(--green); }

    @keyframes shimmer-sweep {
      0% { left: -100%; opacity: 0; }
      50% { opacity: 1; }
      100% { left: 100%; opacity: 0; }
    }
    @keyframes holographic-pulse {
      0%, 100% { background: linear-gradient(180deg, #34d399 0%, #10b981 30%, #059669 60%, #047857 100%); }
      50% { background: linear-gradient(180deg, #1ade9a 0%, #34d399 30%, #10b981 60%, #059669 100%); }
    }
    @keyframes glow-surge {
      0%, 100% { box-shadow: 0 4px 20px rgba(52, 211, 153, 0.3), 0 8px 30px rgba(0, 0, 0, 0.5), inset 0 1px 0 rgba(255, 255, 255, 0.1), inset 0 -2px 10px rgba(52, 211, 153, 0.15); }
      50% { box-shadow: 0 6px 30px rgba(52, 211, 153, 0.5), 0 12px 40px rgba(52, 211, 153, 0.2), inset 0 1px 0 rgba(255, 255, 255, 0.15), inset 0 -2px 15px rgba(52, 211, 153, 0.25); }
    }

    /* Confirm Button */
    .confirm-btn { 
      width: 100%; 
      height: 64px; 
      background: linear-gradient(180deg, #3a3a48 0%, #2a2a35 40%, #1a1a22 100%); 
      border: 2px solid #34d399; 
      border-radius: 12px; 
      font-family: inherit; 
      font-size: 18px; 
      font-weight: 800; 
      letter-spacing: 3px; 
      text-transform: uppercase; 
      color: transparent; 
      cursor: pointer; 
      transition: all 0.2s; 
      display: flex; 
      align-items: center; 
      justify-content: center; 
      position: relative; 
      overflow: hidden;
      box-shadow: 0 4px 20px rgba(52, 211, 153, 0.3), 0 8px 30px rgba(0, 0, 0, 0.5), inset 0 1px 0 rgba(255, 255, 255, 0.1), inset 0 -2px 10px rgba(52, 211, 153, 0.15);
    }
    .confirm-btn::before {
      content: 'CONFIRM WAGER';
      background: linear-gradient(180deg, #34d399 0%, #10b981 30%, #059669 60%, #047857 100%);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
      position: relative;
      z-index: 2;
    }
    .confirm-btn::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(180deg, #3a3a48 0%, #2a2a35 40%, #1a1a22 100%);
      border-radius: 10px;
      z-index: -1;
    }
    .confirm-btn::before:hover {
      animation: holographic-pulse 2s ease-in-out;
    }
    .confirm-btn:hover::before {
      animation: holographic-pulse 2s ease-in-out;
    }
    /* Shimmer shine effect */
    .confirm-btn:hover::before::after,
    .confirm-btn:active::before::after {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent 0%, rgba(255, 255, 255, 0.3) 50%, transparent 100%);
      animation: shimmer-sweep 0.6s ease-in-out;
      pointer-events: none;
    }
    /* Holographic shimmer layer on hover */
    .confirm-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 25px rgba(52, 211, 153, 0.4), 0 10px 35px rgba(0, 0, 0, 0.6), inset 0 1px 0 rgba(255, 255, 255, 0.15);
      border-color: #10b981;
      animation: glow-surge 1.5s ease-in-out infinite;
    }
    .confirm-btn:hover::before {
      animation: holographic-pulse 2s ease-in-out infinite;
    }
    /* Create shimmer effect on hover */
    .confirm-btn:hover {
      background: 
        linear-gradient(90deg, transparent 0%, rgba(52, 211, 153, 0.1) 50%, transparent 100%),
        linear-gradient(180deg, #3a3a48 0%, #2a2a35 40%, #1a1a22 100%);
      background-size: 200% 100%, 100% 100%;
      background-position: -200% 0, 0 0;
      animation: shimmer-sweep 0.6s ease-in-out;
    }
    .confirm-btn:active { 
      transform: translateY(0);
      box-shadow: 0 2px 15px rgba(52, 211, 153, 0.5), 0 4px 20px rgba(52, 211, 153, 0.2), inset 0 1px 0 rgba(255, 255, 255, 0.2);
    }
    .confirm-btn:active::before {
      animation: holographic-pulse 0.8s ease-in-out;
    }
    .confirm-btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; box-shadow: none; animation: none; }

    /* Fireworks */
    .fireworks-container { position: fixed; top: 0; left: 0; right: 0; bottom: 0; pointer-events: none; z-index: 9999; overflow: hidden; }
    .firework { position: absolute; width: 4px; height: 4px; border-radius: 50%; }
    .firework-trail { position: absolute; width: 3px; height: 20px; border-radius: 2px; transform-origin: bottom center; }
    @keyframes firework-launch { 
      0% { transform: translateY(0) scale(1); opacity: 1; } 
      100% { transform: translateY(-60vh) scale(0.5); opacity: 0.8; } 
    }
    @keyframes firework-explode { 
      0% { transform: scale(0) translate(0, 0); opacity: 1; } 
      50% { opacity: 1; }
      100% { transform: scale(1) translate(var(--tx), var(--ty)); opacity: 0; } 
    }
    @keyframes firework-sparkle {
      0%, 100% { opacity: 1; transform: scale(1); }
      50% { opacity: 0.5; transform: scale(0.8); }
    }

    /* Success Modal */
    .success-modal { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%) scale(0.8); background: linear-gradient(180deg, #2a1a2e 0%, #1a0d1e 100%); border-radius: 24px; padding: 36px 24px; text-align: center; z-index: 300; opacity: 0; visibility: hidden; transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1); width: calc(100% - 40px); max-width: 340px; }
    .success-modal.show { opacity: 1; visibility: visible; transform: translate(-50%, -50%) scale(1); }
    .success-icon { width: 56px; height: 56px; background: linear-gradient(135deg, var(--green), var(--green-glow)); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 26px; margin: 0 auto 14px; animation: successPop 0.5s cubic-bezier(0.16, 1, 0.3, 1); }
    @keyframes successPop { 0% { transform: scale(0); } 50% { transform: scale(1.2); } 100% { transform: scale(1); } }
    .success-title { font-size: 24px; font-weight: 700; margin-bottom: 6px; }
    .success-message { font-size: 13px; color: var(--white-50); margin-bottom: 24px; }
    .success-details { background: rgba(255,255,255,0.03); border-radius: 14px; padding: 16px; margin-bottom: 24px; border-top: 1px solid rgba(255,255,255,0.05); }
    .success-details-row { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid rgba(255,255,255,0.05); font-size: 14px; }
    .success-details-row:last-child { border-bottom: none; }
    .success-btn { width: 100%; padding: 18px; background: linear-gradient(180deg, #3a3a48 0%, #2a2a35 40%, #1a1a22 100%); border: 2px solid #a87d52; border-radius: 12px; font-family: inherit; font-size: 15px; font-weight: 800; letter-spacing: 2px; text-transform: uppercase; color: transparent; cursor: pointer; transition: all 0.2s; box-shadow: 0 4px 20px rgba(168, 125, 82, 0.3), 0 8px 30px rgba(0, 0, 0, 0.5), inset 0 1px 0 rgba(255, 255, 255, 0.1); position: relative; overflow: hidden; -webkit-tap-highlight-color: transparent; }
    .success-btn span { background: linear-gradient(180deg, #d4a574 0%, #a87d52 50%, #8b6543 100%); -webkit-background-clip: text; background-clip: text; color: transparent; position: relative; z-index: 1; }
    .success-btn:active { transform: scale(0.98); }

    /* Token Purchase Modal */
    .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.8); backdrop-filter: blur(10px); z-index: 400; opacity: 0; visibility: hidden; transition: all 0.3s; display: flex; align-items: center; justify-content: center; padding: 20px; }
    .modal-overlay.show { opacity: 1; visibility: visible; }
    .modal { background: linear-gradient(180deg, #1a1a24 0%, #0d0d12 100%); border: 1px solid rgba(168, 125, 82, 0.3); border-radius: 24px; padding: 32px; max-width: 400px; width: 100%; transform: scale(0.9); transition: transform 0.3s; box-shadow: 0 0 40px rgba(0, 0, 0, 0.8), 0 0 20px rgba(168, 125, 82, 0.1); }
    .modal-overlay.show .modal { transform: scale(1); }
    .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; }
    .modal-title { font-size: 24px; font-weight: 700; display: flex; align-items: center; gap: 8px; }
    .title-icon-shine { display: inline-block; animation: slowShine 3s ease-in-out infinite; }
    @keyframes slowShine { 0%, 100% { opacity: 0.6; filter: brightness(1); } 50% { opacity: 1; filter: brightness(1.3) drop-shadow(0 0 8px rgba(251, 191, 36, 0.5)); } }
    .modal-close { width: 36px; height: 36px; background: var(--white-10); border: none; border-radius: 50%; color: var(--white-70); font-size: 20px; cursor: pointer; }
    .token-packages { display: flex; flex-direction: column; gap: 16px; }
    .token-package { padding: 20px; background: linear-gradient(180deg, #1a1a22 0%, #12121a 100%); border: 2px solid rgba(90, 90, 106, 0.5); border-radius: 16px; cursor: pointer; transition: all 0.2s; display: flex; justify-content: space-between; align-items: center; position: relative; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.05); }
    .token-package:hover { background: linear-gradient(180deg, #22222e 0%, #18181f 100%); border-color: rgba(168, 125, 82, 0.5); box-shadow: 0 6px 20px rgba(0, 0, 0, 0.4), 0 0 15px rgba(168, 125, 82, 0.15); }
    .token-package.selected { border-color: #a87d52; background: linear-gradient(180deg, rgba(168, 125, 82, 0.15) 0%, rgba(124, 58, 237, 0.1) 100%); box-shadow: 0 0 20px rgba(168, 125, 82, 0.25), 0 4px 15px rgba(0, 0, 0, 0.4), inset 0 0 20px rgba(168, 125, 82, 0.05); }
    .token-package-badge { position: absolute; top: -10px; right: 16px; background: linear-gradient(180deg, #d4a574 0%, #a87d52 50%, #8b6543 100%); padding: 4px 12px; border-radius: 100px; font-size: 10px; font-weight: 700; letter-spacing: 1px; color: #1a1a22; box-shadow: 0 4px 12px rgba(168, 125, 82, 0.4); text-shadow: 0 1px 0 rgba(255, 255, 255, 0.2); }
    .token-package-info { display: flex; align-items: center; gap: 12px; }
    .token-package-icon { min-width: 52px; height: 52px; padding: 4px; background: linear-gradient(180deg, #d4a574 0%, #a87d52 50%, #8b6543 100%); border-radius: 12px; display: flex; flex-wrap: wrap; align-items: center; justify-content: center; font-size: 16px; line-height: 1; letter-spacing: -4px; box-shadow: 0 4px 12px rgba(168, 125, 82, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.2); }
    .token-package-icon.triple { flex-direction: column; letter-spacing: -3px; font-size: 14px; }
    .token-package-icon.triple .top { margin-bottom: -2px; }
    .token-package-amount { font-family: 'Space Grotesk', monospace; font-size: 22px; font-weight: 700; background: linear-gradient(180deg, #ffffff 0%, #c4c4c4 100%); -webkit-background-clip: text; background-clip: text; color: transparent; }
    .token-package-label { font-size: 12px; color: var(--white-50); }
    .token-package-price { font-size: 22px; font-weight: 700; background: linear-gradient(180deg, #d4a574 0%, #a87d52 100%); -webkit-background-clip: text; background-clip: text; color: transparent; }
    .buy-tokens-btn { width: 100%; padding: 18px; background: linear-gradient(180deg, #2d3a2b 0%, #1f2a1f 40%, #151d15 100%); border: 2px solid #3d8060; border-radius: 14px; font-family: inherit; font-size: 18px; font-weight: 800; letter-spacing: 2px; text-transform: uppercase; color: transparent; cursor: pointer; margin-top: 20px; transition: all 0.2s; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5), inset 0 1px 0 rgba(255, 255, 255, 0.05); position: relative; overflow: hidden; }
    .buy-tokens-btn::before { content: ''; position: absolute; top: 0; left: -100%; width: 100%; height: 100%; background: linear-gradient(90deg, transparent, rgba(255,255,255,0.15), transparent); transition: left 0.5s ease; }
    .buy-tokens-btn:hover::before { left: 100%; }
    .buy-tokens-btn span { background: linear-gradient(180deg, #5cb88a 0%, #3d8060 50%, #2d6048 100%); -webkit-background-clip: text; background-clip: text; color: transparent; position: relative; z-index: 1; }
    .buy-tokens-btn:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(0, 0, 0, 0.6); }

    /* Empty/Loading States */
    .empty-state { text-align: center; padding: 60px 20px; color: var(--white-50); }
    .empty-state-icon { font-size: 48px; margin-bottom: 16px; }
    .empty-state-title { font-size: 20px; font-weight: 600; color: var(--white-70); margin-bottom: 8px; }
    .loading { display: flex; align-items: center; justify-content: center; padding: 40px; }
    .spinner { width: 40px; height: 40px; border: 3px solid var(--white-10); border-top-color: #06b6d4; border-radius: 50%; animation: spin 1s linear infinite; }
    @keyframes spin { to { transform: rotate(360deg); } }

    @media (max-width: 480px) {
      .header { padding: 12px 16px; }
      .logo { font-size: 18px; }
      .main { padding: 70px 12px 100px; }
      .prediction-card { padding: 16px; }
      .prediction-title { font-size: 16px; }
      .odds-multiplier { font-size: 18px; }
    }

    /* Bottom Navigation - WallStreetPredict Style */
    .bottom-nav {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: linear-gradient(180deg, #0a1520 0%, #050a0f 100%);
      border-top: 1px solid rgba(6, 182, 212, 0.15);
      display: flex;
      justify-content: space-around;
      align-items: flex-end;
      padding: 12px 0 28px;
      max-width: 600px;
      margin: 0 auto;
      z-index: 1000;
      width: 100%;
    }

    .nav-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
      color: var(--white-50);
      text-decoration: none;
      font-size: 10px;
      font-weight: 500;
      transition: all 0.2s;
    }

    .nav-item:hover {
      color: var(--white);
    }

    .nav-item.active {
      color: #06b6d4;
    }

    .nav-item svg {
      width: 22px;
      height: 22px;
    }

    .nav-item.predictions .nav-icon-wrapper {
      position: relative;
    }

    .nav-item.predictions .nav-icon {
      font-size: 20px;
    }

    .nav-live-dot {
      display: none;
    }

    @supports (padding-bottom: env(safe-area-inset-bottom)) {
      .main {
        padding-bottom: calc(120px + env(safe-area-inset-bottom));
      }
      .bottom-nav {
        padding-bottom: calc(12px + env(safe-area-inset-bottom));
      }
    }
  </style>
</head>
<body>

  <header class="header">
    <div class="header-actions">
      <div class="token-balance" onclick="openTokenModal()">
        <span class="token-amount" id="userBalance">0</span>
        <span class="token-label">tokens</span>
      </div>
    </div>
  </header>

  <main class="main">
    <div class="category-tabs">
      <button class="category-tab active" data-category="daily">üìà Daily</button>
      <button class="category-tab" data-category="weekly">üìä Weekly</button>
      <button class="category-tab" data-category="crypto">‚Çø Crypto</button>
      <button class="category-tab" data-category="earnings">üí∞ Earnings</button>
      <button class="category-tab" data-category="fed">üèõÔ∏è Fed</button>
      <button class="category-tab" data-category="politics">üó≥Ô∏è Politics</button>
    </div>
    <div class="predictions-grid" id="predictionsGrid">
      <div class="loading"><div class="spinner"></div></div>
    </div>
  </main>

  <div class="bet-slip-overlay" id="betSlipOverlay">
    <div class="bet-slip" id="betSlip">
      <div class="bet-slip-handle"></div>
      <div class="bet-slip-header">
        <div>
          <div class="bet-slip-title">Place your bet</div>
          <div class="bet-slip-question" id="betSlipQuestion">Will TSLA close green today?</div>
          <div class="bet-slip-date" id="betSlipDate">üìÖ Friday, Jan 16</div>
        </div>
        <button class="bet-slip-close" onclick="closeBetSlip()">√ó</button>
      </div>
      <div class="position-selector">
        <button class="position-btn yes" id="positionYes" onclick="selectPosition('yes')">
          <div class="position-btn-label">YES ‚úì</div>
          <div class="position-btn-multiplier" id="yesMultiplier">2.0x payout</div>
        </button>
        <button class="position-btn no" id="positionNo" onclick="selectPosition('no')">
          <div class="position-btn-label">NO ‚úó</div>
          <div class="position-btn-multiplier" id="noMultiplier">2.0x payout</div>
        </button>
      </div>
      <div class="token-quick-select">
        <button class="token-quick-btn" data-amount="50">50</button>
        <button class="token-quick-btn" data-amount="100">100</button>
        <button class="token-quick-btn" data-amount="250">250</button>
      </div>
      <div class="custom-amount-row">
        <input type="number" class="custom-amount-input" id="betAmount" placeholder="Enter amount..." min="10" max="10000">
        <button class="max-btn" onclick="setMaxBet()">MAX</button>
      </div>
      <div class="payout-preview">
        <div class="payout-row"><span class="payout-label">Your bet</span><span class="payout-value" id="previewBet">0 tokens</span></div>
        <div class="payout-row"><span class="payout-label">Multiplier</span><span class="payout-value" id="previewMultiplier">2.0x</span></div>
        <div class="payout-row"><span class="payout-label">Potential payout</span><span class="payout-value profit" id="previewPayout">0 tokens</span></div>
      </div>
      <button class="confirm-btn" id="confirmBetBtn" onclick="confirmBet()"></button>
    </div>
  </div>

  <div class="success-modal" id="successModal">
    <div class="success-icon">‚úì</div>
    <div class="success-title">Bet Placed!</div>
    <div class="success-message" id="successMessage">Your position is locked in</div>
    <div class="success-details">
      <div class="success-details-row"><span style="color: var(--white-50)">Wagered</span><span id="successWagered">100 tokens</span></div>
      <div class="success-details-row"><span style="color: var(--white-50)">Position</span><span id="successPosition">YES</span></div>
      <div class="success-details-row"><span style="color: var(--white-50)">To Win</span><span style="color: var(--green)" id="successPotential">200 tokens</span></div>
    </div>
    <button class="success-btn" onclick="closeSuccessModal()"><span>Continue</span></button>
  </div>

  <div class="modal-overlay" id="tokenModal">
    <div class="modal">
      <div class="modal-header">
        <div class="modal-title">Get Tokens <span class="title-icon-shine">üí∞</span></div>
        <button class="modal-close" onclick="closeTokenModal()">√ó</button>
      </div>
      <div class="token-packages">
        <div class="token-package" data-package="starter" onclick="selectPackage('starter')">
          <div class="token-package-info"><div class="token-package-icon">üí∞</div><div><div class="token-package-amount">250</div><div class="token-package-label">tokens</div></div></div>
          <div class="token-package-price">$4.99</div>
        </div>
        <div class="token-package selected" data-package="popular" onclick="selectPackage('popular')">
          <div class="token-package-badge">BEST VALUE</div>
          <div class="token-package-info"><div class="token-package-icon">üí∞üí∞</div><div><div class="token-package-amount">1,000</div><div class="token-package-label">tokens</div></div></div>
          <div class="token-package-price">$9.99</div>
        </div>
        <div class="token-package" data-package="whale" onclick="selectPackage('whale')">
          <div class="token-package-info"><div class="token-package-icon triple"><span class="top">üí∞</span><span>üí∞üí∞</span></div><div><div class="token-package-amount">2,500</div><div class="token-package-label">tokens</div></div></div>
          <div class="token-package-price">$14.99</div>
        </div>
      </div>
      <button class="buy-tokens-btn" onclick="purchaseTokens()"><span>Purchase Tokens</span></button>
    </div>
  </div>

  <!-- Bottom Navigation -->
  <nav class="bottom-nav">
    <a href="dashboard.html" class="nav-item">
      <svg viewBox="0 0 24 24" fill="currentColor">
        <path d="M12 3L2 12h3v8h6v-6h2v6h6v-8h3L12 3z"/>
      </svg>
      <span>Home</span>
    </a>
    <a href="#" class="nav-item" onclick="openMyBets(); return false;">
      <svg viewBox="0 0 24 24" fill="currentColor">
        <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 14l-5-5 1.41-1.41L12 14.17l4.59-4.58L18 11l-6 6z"/>
      </svg>
      <span>Open Bets</span>
    </a>
    <a href="predictions.html" class="nav-item active predictions">
      <div class="nav-icon-wrapper">
        <span class="nav-icon">üîÆ</span>
        <div class="nav-live-dot"></div>
      </div>
      <span>Predict</span>
    </a>
    <a href="#" class="nav-item" onclick="openBetSlip(); return false;">
      <svg viewBox="0 0 24 24" fill="currentColor">
        <path d="M14 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z"/>
      </svg>
      <span>Bet Slip</span>
    </a>
    <a href="#" class="nav-item" onclick="openHistory(); return false;">
      <svg viewBox="0 0 24 24" fill="currentColor">
        <path d="M13 3a9 9 0 00-9 9H1l3.89 3.89.07.14L9 12H6c0-3.87 3.13-7 7-7s7 3.13 7 7-3.13 7-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42A8.954 8.954 0 0013 21a9 9 0 000-18zm-1 5v5l4.28 2.54.72-1.21-3.5-2.08V8H12z"/>
      </svg>
      <span>History</span>
    </a>
  </nav>

  <div class="fireworks-container" id="fireworksContainer"></div>

  <!-- My Bets Modal -->
  <div class="my-bets-modal" id="myBetsModal">
    <div class="my-bets-content">
      <div class="my-bets-header">
        <div class="my-bets-title" id="myBetsModalTitle">Open Bets</div>
        <button class="my-bets-close" onclick="closeMyBets()">√ó</button>
      </div>
      <div id="myBetsList"></div>
    </div>
  </div>

  <script>
    let userEmail = localStorage.getItem('userEmail') || '';
    let userBalance = 0;
    let predictions = [];
    let currentCategory = 'daily';
    let selectedPrediction = null;
    let selectedPosition = null;
    let selectedPackage = 'popular';

    // Secret admin access - tap logo 5 times quickly
    let logoTapCount = 0;
    let logoTapTimer = null;
    document.getElementById('apehubLogo')?.addEventListener('click', () => {
      logoTapCount++;
      clearTimeout(logoTapTimer);
      if (logoTapCount >= 5) {
        logoTapCount = 0;
        window.location.href = '/admin/admin.html';
      }
      logoTapTimer = setTimeout(() => { logoTapCount = 0; }, 1500);
    });

    document.addEventListener('DOMContentLoaded', () => {
      if (!userEmail) {
        userEmail = prompt('Enter your email to start betting:');
        if (userEmail) localStorage.setItem('userEmail', userEmail);
      }
      loadBalance();
      loadPredictions();
      setupCategoryTabs();
      setupTokenQuickSelect();
      setupBetAmountInput();
      
      const urlParams = new URLSearchParams(window.location.search);
      if (urlParams.get('purchase') === 'success') {
        const tokens = urlParams.get('tokens');
        showPurchaseSuccess(tokens);
        window.history.replaceState({}, '', '/predictions.html');
      }

      // Auto-refresh every 5 seconds
      setInterval(() => {
        loadBalance();
        loadPredictions();
      }, 5000);
    });

    async function loadBalance() {
      if (!userEmail) return;
      try {
        const res = await fetch(`/api/predictions/tokens/balance?email=${encodeURIComponent(userEmail)}`);
        const data = await res.json();
        if (data.success) {
          userBalance = data.balance;
          document.getElementById('userBalance').textContent = Math.floor(userBalance).toLocaleString();
        }
      } catch (err) { console.error('Error loading balance:', err); }
    }

    async function loadPredictions() {
      const grid = document.getElementById('predictionsGrid');
      try {
        let url = '/api/predictions?status=open';
        if (currentCategory !== 'all') url += `&category=${currentCategory}`;
        const res = await fetch(url);
        const data = await res.json();
        if (data.success) { predictions = data.predictions; renderPredictions(); }
      } catch (err) {
        console.error('Error loading predictions:', err);
        grid.innerHTML = `<div class="empty-state"><div class="empty-state-icon">‚ö†Ô∏è</div><div class="empty-state-title">Failed to load predictions</div><p>Please try again later</p></div>`;
      }
    }

    async function placeBet() {
      if (!selectedPrediction || !selectedPosition) return;
      const amount = parseInt(document.getElementById('betAmount').value);
      if (!amount || amount < 10) { alert('Minimum bet is 10 tokens'); return; }
      if (amount > userBalance) { alert('Insufficient tokens! Purchase more to continue.'); openTokenModal(); return; }
      try {
        const res = await fetch('/api/predictions/bet', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email: userEmail, predictionId: selectedPrediction.id, position: selectedPosition, amount: amount })
        });
        const data = await res.json();
        if (data.success) {
          userBalance = data.newBalance;
          document.getElementById('userBalance').textContent = Math.floor(userBalance).toLocaleString();
          showBetSuccess(data.bet);
          loadPredictions();
        } else { alert(data.error || 'Failed to place bet'); }
      } catch (err) { console.error('Error placing bet:', err); alert('Failed to place bet. Please try again.'); }
    }

    async function purchaseTokens() {
      if (!userEmail) { userEmail = prompt('Enter your email:'); if (!userEmail) return; localStorage.setItem('userEmail', userEmail); }
      try {
        const res = await fetch('/api/predictions/tokens/purchase', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ packageId: selectedPackage, email: userEmail })
        });
        const data = await res.json();
        if (data.success && data.url) { window.location.href = data.url; }
        else { alert(data.error || 'Failed to start purchase'); }
      } catch (err) { console.error('Error purchasing tokens:', err); alert('Failed to process purchase. Please try again.'); }
    }

    function renderPredictions() {
      const grid = document.getElementById('predictionsGrid');
      if (predictions.length === 0) {
        grid.innerHTML = `<div class="empty-state"><div class="empty-state-icon">üîÆ</div><div class="empty-state-title">No predictions available</div><p>Check back soon for new markets!</p></div>`;
        return;
      }
      // Gather all tickers for open predictions
      const tickers = predictions.filter(p => p.ticker).map(p => p.ticker);
      if (tickers.length === 0) {
        grid.innerHTML = predictions.map(p => renderPredictionCard(p, null)).join('');
        return;
      }
      // Fetch Alpaca snapshots for all tickers
      fetch(`/api/market/snapshots?symbols=${tickers.join(',')}`)
        .then(res => res.json())
        .then(marketData => {
          grid.innerHTML = predictions.map(p => {
            const snapshot = marketData.snapshots?.[p.ticker] || null;
            return renderPredictionCard(p, snapshot);
          }).join('');
        })
        .catch(() => {
          grid.innerHTML = predictions.map(p => renderPredictionCard(p, null)).join('');
        });
    }

    // Helper to render a single prediction card with optional market data
    // All-time high prices for reference (updated periodically)
    const ALL_TIME_HIGHS = {
      'META': { price: 638.40, date: 'Jan 2025' },
      'NVDA': { price: 153.13, date: 'Jan 2025' },
      'TSLA': { price: 488.54, date: 'Jan 2025' },
      'AAPL': { price: 260.10, date: 'Dec 2024' },
      'MSFT': { price: 468.35, date: 'Dec 2024' },
      'GOOGL': { price: 201.42, date: 'Dec 2024' },
      'AMZN': { price: 233.00, date: 'Jan 2025' },
      'SPY': { price: 609.07, date: 'Dec 2024' },
      'QQQ': { price: 538.28, date: 'Dec 2024' },
      'AMD': { price: 227.30, date: 'Mar 2024' },
    };
    
    // Week start prices (would ideally fetch from API, store Monday open)
    let weekStartPrices = {};
    
    function getWeekStartPrice(ticker) {
      return weekStartPrices[ticker] || null;
    }
    
    function generateReferenceInfo(p, snapshot) {
      const title = p.title.toLowerCase();
      const ticker = p.ticker;
      let refHtml = '';
      
      // All-time high questions
      if (title.includes('all-time high') || title.includes('all time high') || title.includes('ath')) {
        const ath = ALL_TIME_HIGHS[ticker];
        if (ath && snapshot) {
          const currentPrice = parseFloat(snapshot.price);
          const diff = ((currentPrice - ath.price) / ath.price * 100).toFixed(2);
          const diffClass = currentPrice >= ath.price ? 'positive' : 'negative';
          refHtml = `
            <div class="prediction-reference">
              <span class="ref-item"><span class="ref-label">ATH: </span><span class="ref-value">$${ath.price.toFixed(2)}</span></span>
              <span class="ref-item"><span class="ref-label">Now: </span><span class="ref-value ${diffClass}">$${currentPrice.toFixed(2)} (${diff > 0 ? '+' : ''}${diff}%)</span></span>
            </div>
          `;
        }
      }
      // Weekly range questions
      else if (p.category === 'weekly' && snapshot) {
        const weekStart = getWeekStartPrice(ticker);
        if (weekStart) {
          const currentPrice = parseFloat(snapshot.price);
          const diff = ((currentPrice - weekStart) / weekStart * 100).toFixed(2);
          const diffClass = diff >= 0 ? 'positive' : 'negative';
          refHtml = `
            <div class="prediction-reference">
              <span class="ref-item"><span class="ref-label">Week Start: </span><span class="ref-value">$${weekStart.toFixed(2)}</span></span>
              <span class="ref-item"><span class="ref-label">Now: </span><span class="ref-value ${diffClass}">${diff > 0 ? '+' : ''}${diff}%</span></span>
            </div>
          `;
        }
      }
      // Daily close green - show day's open price if available
      else if (p.category === 'daily' && title.includes('close green') && snapshot) {
        const openPrice = snapshot.dailyBar?.o || snapshot.open;
        if (openPrice) {
          const currentPrice = parseFloat(snapshot.price);
          const diff = ((currentPrice - openPrice) / openPrice * 100).toFixed(2);
          const diffClass = currentPrice >= openPrice ? 'positive' : 'negative';
          const statusText = currentPrice >= openPrice ? 'Winning' : 'Losing';
          refHtml = `
            <div class="prediction-reference">
              <span class="ref-item"><span class="ref-label">Open: </span><span class="ref-value">$${parseFloat(openPrice).toFixed(2)}</span></span>
              <span class="ref-item"><span class="ref-value ${diffClass}">${statusText} (${diff > 0 ? '+' : ''}${diff}%)</span></span>
            </div>
          `;
        }
      }
      
      return refHtml;
    }
    
    // Helper function to get source info based on category
    function getSourceInfo(category) {
      const sources = {
        'daily': { name: 'DailyEdge', icon: 'üìà' },
        'weekly': { name: 'DailyEdge', icon: 'üìä' },
        'crypto': { name: 'Polymarket', icon: 'P' },
        'earnings': { name: 'Kalshi', icon: 'K' },
        'fed': { name: 'Polymarket', icon: 'P' },
        'politics': { name: 'Polymarket', icon: 'P' }
      };
      return sources[category] || { name: 'DailyEdge', icon: 'üìà' };
    }

    function renderPredictionCard(p, snapshot) {
      const isLocked = isDailyBettingLocked(p);
      const lockedClass = isLocked ? 'locked' : '';
      
      // Calculate probability from multipliers
      const yesProbability = (1 / parseFloat(p.yes_payout_multiplier) * 100).toFixed(0);
      const noProbability = (100 - parseFloat(yesProbability)).toFixed(0);
      
      // Calculate price from probability (Polymarket style)
      const yesPrice = (yesProbability / 100).toFixed(2);
      const noPrice = (noProbability / 100).toFixed(2);
      
      // Simulate change value
      const changeValue = (Math.random() * 5 - 1).toFixed(1);
      const isPositive = parseFloat(changeValue) >= 0;
      
      // Get source info
      const sourceInfo = getSourceInfo(p.category);
      
      return `
        <div class="prediction-card ${p.featured ? 'featured' : ''} ${lockedClass}" onclick="openBetSlip(${p.id})">
          ${isLocked ? '<div class="locked-badge">üîí LOCKED</div>' : ''}
          
          <div class="prediction-content">
            <div class="prediction-info">
              <div class="prediction-title">${p.title}</div>
              <div class="prediction-probability">
                <span class="probability-value">${yesProbability}%</span>
                <span class="probability-change ${isPositive ? 'up' : 'down'}">${isPositive ? '+' : ''}${changeValue}%</span>
              </div>
            </div>
          </div>
          
          <div class="prediction-odds">
            <button class="odds-button yes ${isLocked ? 'disabled' : ''}" onclick="event.stopPropagation(); ${isLocked ? 'showLockedMessage()' : `openBetSlip(${p.id}, 'yes')`}">
              <span class="odds-label">YES ‚úì</span>
              <span class="odds-price">${(1/parseFloat(yesPrice)).toFixed(1)}x payout</span>
            </button>
            <button class="odds-button no ${isLocked ? 'disabled' : ''}" onclick="event.stopPropagation(); ${isLocked ? 'showLockedMessage()' : `openBetSlip(${p.id}, 'no')`}">
              <span class="odds-label">NO ‚úó</span>
              <span class="odds-price">${(1/parseFloat(noPrice)).toFixed(1)}x payout</span>
            </button>
          </div>
          
          <div class="prediction-footer">
            <div class="prediction-volume"><strong>${(p.yes_volume + p.no_volume).toLocaleString()}</strong> tokens bet</div>
            <div class="prediction-closes">${isLocked ? '<span class="locked-text">Resolves 4:30pm ET</span>' : `Closes <span class="time">${formatTimeLeft(p.closes_at)}</span>`}</div>
          </div>
        </div>
      `;
    }

    // Check if daily betting is locked (after 9:30am ET)
    function isDailyBettingLocked(prediction) {
      if (prediction.category !== 'daily') return false;
      const now = new Date();
      // Convert to ET
      const etTimeStr = now.toLocaleString('en-US', { timeZone: 'America/New_York' });
      const etNow = new Date(etTimeStr);
      const etHour = etNow.getHours();
      const etMinute = etNow.getMinutes();
      const currentETMinutes = etHour * 60 + etMinute;
      const cutoffETMinutes = 9 * 60 + 30; // 9:30am = 570 minutes
      return currentETMinutes >= cutoffETMinutes;
    }

    function getCategoryLabel(category) {
      const labels = {
        'daily': 'üìà DAILY',
        'weekly': 'üìä WEEKLY',
        'crypto': '‚Çø CRYPTO',
        'earnings': 'üí∞ EARNINGS',
        'fed': 'üèõÔ∏è FED',
        'politics': 'üó≥Ô∏è POLITICS'
      };
      return labels[category] || category.toUpperCase();
    }

    function formatPredictionDate(dateStr) {
      if (!dateStr) return '';
      const date = new Date(dateStr);
      if (isNaN(date.getTime())) return '';
      return date.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric', timeZone: 'America/New_York' });
    }

    function formatCurrentTime() {
      const now = new Date();
      return now.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit', hour12: true, timeZone: 'America/New_York' }) + ' ET';
    }

    function showLockedMessage() {
      alert('üîí Betting Closed!\n\nDaily predictions lock at 9:30am ET when the market opens. Check back tonight at 8pm ET for tomorrow\'s predictions!');
    }

    function formatTimeLeft(dateStr) {
      const now = new Date();
      const closes = new Date(dateStr);
      const diff = closes - now;
      if (diff < 0) return 'Closed';
      const hours = Math.floor(diff / (1000 * 60 * 60));
      const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
      if (hours > 24) { const days = Math.floor(hours / 24); return `${days}d ${hours % 24}h`; }
      return `${hours}h ${minutes}m`;
    }

    function openBetSlip(predictionId, position = null) {
      selectedPrediction = predictions.find(p => p.id === predictionId);
      if (!selectedPrediction) return;
      
      // Check if betting is locked for this prediction
      if (isDailyBettingLocked(selectedPrediction)) {
        showLockedMessage();
        return;
      }
      
      document.getElementById('betSlipQuestion').textContent = selectedPrediction.title;
      const dateStr = formatPredictionDate(selectedPrediction.resolves_at);
      document.getElementById('betSlipDate').textContent = dateStr ? `üìÖ ${dateStr} ‚Ä¢ Resolves 4:30pm ET` : 'üìÖ Resolves 4:30pm ET';
      document.getElementById('yesMultiplier').textContent = `${parseFloat(selectedPrediction.yes_payout_multiplier).toFixed(2)}x payout`;
      document.getElementById('noMultiplier').textContent = `${parseFloat(selectedPrediction.no_payout_multiplier).toFixed(2)}x payout`;
      selectedPosition = position;
      document.getElementById('betAmount').value = '';
      document.querySelectorAll('.token-quick-btn').forEach(btn => btn.classList.remove('selected'));
      updatePayoutPreview();
      document.getElementById('positionYes').classList.toggle('selected', position === 'yes');
      document.getElementById('positionNo').classList.toggle('selected', position === 'no');
      document.getElementById('betSlipOverlay').classList.add('show');
      document.body.style.overflow = 'hidden';
    }

    function closeBetSlip() {
      document.getElementById('betSlipOverlay').classList.remove('show');
      document.body.style.overflow = '';
      selectedPrediction = null;
      selectedPosition = null;
    }

    function selectPosition(pos) {
      selectedPosition = pos;
      document.getElementById('positionYes').classList.toggle('selected', pos === 'yes');
      document.getElementById('positionNo').classList.toggle('selected', pos === 'no');
      updatePayoutPreview();
    }

    function updatePayoutPreview() {
      const amount = parseInt(document.getElementById('betAmount').value) || 0;
      let multiplier = 2.0;
      if (selectedPrediction && selectedPosition) {
        multiplier = selectedPosition === 'yes' ? parseFloat(selectedPrediction.yes_payout_multiplier) : parseFloat(selectedPrediction.no_payout_multiplier);
      }
      const payout = Math.floor(amount * multiplier);
      document.getElementById('previewBet').textContent = `${amount.toLocaleString()} tokens`;
      document.getElementById('previewMultiplier').textContent = `${multiplier.toFixed(2)}x`;
      document.getElementById('previewPayout').textContent = `${payout.toLocaleString()} tokens`;
    }

    function setMaxBet() {
      const maxAllowed = Math.min(userBalance, selectedPrediction?.max_bet || 10000);
      document.getElementById('betAmount').value = maxAllowed;
      document.querySelectorAll('.token-quick-btn').forEach(btn => btn.classList.remove('selected'));
      updatePayoutPreview();
    }

    function confirmBet() {
      if (!selectedPosition) { alert('Please select YES or NO'); return; }
      const amount = parseInt(document.getElementById('betAmount').value);
      if (!amount || amount < 10) { alert('Please enter a bet amount (minimum 10 tokens)'); return; }
      placeBet();
    }

    function showBetSuccess(bet) {
      const predictionResolves = selectedPrediction?.resolves_at;
      closeBetSlip();
      document.getElementById('successPosition').textContent = bet.position.toUpperCase();
      document.getElementById('successPosition').style.color = bet.position === 'yes' ? 'var(--green)' : 'var(--red)';
      document.getElementById('successWagered').textContent = `${bet.tokens_wagered.toLocaleString()} tokens`;
      document.getElementById('successPotential').textContent = `${bet.potential_payout.toLocaleString()} tokens`;
      document.getElementById('successTime').textContent = formatCurrentTime();
      const dateStr = formatPredictionDate(predictionResolves);
      document.getElementById('successResolves').textContent = dateStr ? `${dateStr} 4:30pm ET` : '4:30pm ET';
      document.getElementById('successModal').classList.add('show');
      launchFireworks();
    }

    function closeSuccessModal() { document.getElementById('successModal').classList.remove('show'); }
    function showPurchaseSuccess(tokens) { loadBalance(); alert(`üéâ Success! ${tokens} tokens added to your account!`); launchFireworks(); }

    function launchFireworks() {
      const container = document.getElementById('fireworksContainer');
      const colors = ['#7c3aed', '#a855f7', '#e879f9', '#10b981', '#fbbf24', '#ef4444', '#00d4ff', '#ff6b9d'];
      
      // Launch multiple fireworks
      for (let fw = 0; fw < 6; fw++) {
        setTimeout(() => {
          createFirework(container, colors, 20 + Math.random() * 60);
        }, fw * 300);
      }
    }

    function createFirework(container, colors, xPos) {
      const startY = window.innerHeight;
      const explodeY = 150 + Math.random() * 200;
      const color = colors[Math.floor(Math.random() * colors.length)];
      
      // Create launch trail
      const trail = document.createElement('div');
      trail.className = 'firework-trail';
      trail.style.cssText = `left: ${xPos}%; bottom: 0; background: linear-gradient(to top, ${color}, transparent); animation: firework-launch 0.8s ease-out forwards;`;
      container.appendChild(trail);
      
      // After launch, create explosion
      setTimeout(() => {
        trail.remove();
        createExplosion(container, xPos, explodeY, color, colors);
      }, 700);
    }

    function createExplosion(container, x, y, mainColor, colors) {
      const particleCount = 30 + Math.floor(Math.random() * 20);
      const explosionX = (x / 100) * window.innerWidth;
      const explosionY = y;
      
      for (let i = 0; i < particleCount; i++) {
        const particle = document.createElement('div');
        particle.className = 'firework';
        const angle = (i / particleCount) * 360;
        const velocity = 80 + Math.random() * 120;
        const tx = Math.cos(angle * Math.PI / 180) * velocity;
        const ty = Math.sin(angle * Math.PI / 180) * velocity;
        const color = Math.random() > 0.3 ? mainColor : colors[Math.floor(Math.random() * colors.length)];
        const size = 3 + Math.random() * 4;
        const duration = 1 + Math.random() * 0.5;
        
        particle.style.cssText = `
          left: ${explosionX}px; 
          top: ${explosionY}px; 
          width: ${size}px; 
          height: ${size}px; 
          background: ${color}; 
          box-shadow: 0 0 ${size * 2}px ${color}, 0 0 ${size * 4}px ${color};
          --tx: ${tx}px; 
          --ty: ${ty}px; 
          animation: firework-explode ${duration}s ease-out forwards, firework-sparkle 0.1s ease-in-out infinite;
        `;
        container.appendChild(particle);
        setTimeout(() => particle.remove(), duration * 1000);
      }
    }

    function openTokenModal() { document.getElementById('tokenModal').classList.add('show'); }
    function closeTokenModal() { document.getElementById('tokenModal').classList.remove('show'); }
    function selectPackage(pkg) { selectedPackage = pkg; document.querySelectorAll('.token-package').forEach(el => { el.classList.toggle('selected', el.dataset.package === pkg); }); }

    function setupCategoryTabs() {
      document.querySelectorAll('.category-tab').forEach(tab => {
        tab.addEventListener('click', () => {
          document.querySelectorAll('.category-tab').forEach(t => t.classList.remove('active'));
          tab.classList.add('active');
          currentCategory = tab.dataset.category;
          loadPredictions();
        });
      });
    }

    function setupTokenQuickSelect() {
      document.querySelectorAll('.token-quick-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          document.querySelectorAll('.token-quick-btn').forEach(b => b.classList.remove('selected'));
          btn.classList.add('selected');
          document.getElementById('betAmount').value = btn.dataset.amount;
          updatePayoutPreview();
        });
      });
    }

    function setupBetAmountInput() {
      document.getElementById('betAmount').addEventListener('input', () => {
        document.querySelectorAll('.token-quick-btn').forEach(b => b.classList.remove('selected'));
        updatePayoutPreview();
      });
    }

    // ===== MY BETS FUNCTIONS =====
    let myBets = [];
    let currentBetFilter = 'active';

    function openMyBets() {
      document.getElementById('myBetsModalTitle').textContent = 'Open Bets';
      currentBetFilter = 'active';
      document.getElementById('myBetsModal').classList.add('show');
      document.body.style.overflow = 'hidden';
      loadMyBets();
    }

    function closeMyBets() {
      document.getElementById('myBetsModal').classList.remove('show');
      document.body.style.overflow = '';
    }

    function openBetSlip() {
      // Open the bet slip overlay (shows current pending bets)
      const betSlip = document.getElementById('betSlipOverlay');
      if (betSlip) {
        betSlip.classList.add('show');
      } else {
        showNotification('No pending bets in slip', 'info');
      }
    }

    function openHistory() {
      document.getElementById('myBetsModalTitle').textContent = 'Bet History';
      currentBetFilter = 'settled';
      document.getElementById('myBetsModal').classList.add('show');
      document.body.style.overflow = 'hidden';
      loadMyBets();
    }

    async function loadMyBets() {
      if (!userEmail) return;
      const list = document.getElementById('myBetsList');
      list.innerHTML = '<div style="text-align:center;padding:40px;color:var(--white-50);">Loading bets...</div>';
      
      try {
        const res = await fetch(`/api/predictions/bets/my?email=${encodeURIComponent(userEmail)}`);
        const data = await res.json();
        if (data.success) {
          myBets = data.bets;
          renderMyBets();
        }
      } catch (err) {
        console.error('Error loading bets:', err);
        list.innerHTML = '<div style="text-align:center;padding:40px;color:var(--red);">Failed to load bets</div>';
      }
    }

    function filterMyBets(filter) {
      currentBetFilter = filter;
      document.querySelectorAll('.my-bets-tab').forEach(tab => {
        tab.classList.toggle('active', tab.dataset.filter === filter);
      });
      renderMyBets();
    }

    function renderMyBets() {
      const list = document.getElementById('myBetsList');
      let filteredBets = myBets;
      
      if (currentBetFilter === 'active') {
        filteredBets = myBets.filter(b => b.status === 'active');
      } else if (currentBetFilter === 'settled') {
        filteredBets = myBets.filter(b => b.status === 'won' || b.status === 'lost');
      }
      
      if (filteredBets.length === 0) {
        list.innerHTML = '';
        return;
      }
      
      list.innerHTML = filteredBets.map(bet => {
        const placedDate = new Date(bet.placed_at);
        const placedStr = placedDate.toLocaleDateString('en-US', { month: 'short', day: 'numeric', hour: 'numeric', minute: '2-digit', hour12: true, timeZone: 'America/New_York' });
        const resolvesDate = bet.resolves_at ? new Date(bet.resolves_at) : null;
        const resolvesStr = resolvesDate ? resolvesDate.toLocaleDateString('en-US', { month: 'short', day: 'numeric', timeZone: 'America/New_York' }) : '';
        
        return `
          <div class="bet-history-card">
            <div class="bet-history-header">
              <span class="bet-history-ticker">${bet.ticker || bet.category?.toUpperCase() || 'BET'}</span>
              <span class="bet-history-status ${bet.status}">${bet.status === 'active' ? '‚è≥ Active' : bet.status === 'won' ? '‚úÖ Won' : '‚ùå Lost'}</span>
            </div>
            <div class="bet-history-title">${bet.prediction_title}</div>
            <div class="bet-history-details">
              <div class="bet-detail">
                <div class="bet-detail-label">Position</div>
                <div class="bet-detail-value ${bet.position}">${bet.position.toUpperCase()}</div>
              </div>
              <div class="bet-detail">
                <div class="bet-detail-label">Wagered</div>
                <div class="bet-detail-value">${bet.tokens_wagered.toLocaleString()} ü™ô</div>
              </div>
              <div class="bet-detail">
                <div class="bet-detail-label">${bet.status === 'won' ? 'Won' : 'Potential'}</div>
                <div class="bet-detail-value" style="color: ${bet.status === 'won' ? 'var(--green)' : bet.status === 'lost' ? 'var(--red)' : 'var(--gold)'}">
                  ${bet.status === 'won' ? '+' : ''}${(bet.status === 'won' ? bet.tokens_won : bet.potential_payout).toLocaleString()} ü™ô
                </div>
              </div>
              <div class="bet-detail">
                <div class="bet-detail-label">Multiplier</div>
                <div class="bet-detail-value">${parseFloat(bet.payout_multiplier).toFixed(2)}x</div>
              </div>
            </div>
            <div class="bet-history-footer">
              <span>üìÖ Placed: ${placedStr} ET</span>
              <span>${bet.status === 'active' ? `Resolves: ${resolvesStr}` : ''}</span>
            </div>
          </div>
        `;
      }).join('');
    }

    document.getElementById('betSlipOverlay').addEventListener('click', (e) => { if (e.target.id === 'betSlipOverlay') closeBetSlip(); });
    document.getElementById('tokenModal').addEventListener('click', (e) => { if (e.target.id === 'tokenModal') closeTokenModal(); });
    document.getElementById('myBetsModal').addEventListener('click', (e) => { if (e.target.id === 'myBetsModal') closeMyBets(); });
    document.addEventListener('keydown', (e) => { if (e.key === 'Escape') { closeBetSlip(); closeTokenModal(); closeSuccessModal(); closeMyBets(); } });
  </script>
</body>
</html>
